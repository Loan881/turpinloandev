<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Catalogue produits</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff;
      --bg-alt:#f7f7f7;
      --text:#111111;
      --muted:#2d2d2d;
      --line:rgba(0,0,0,.08);
      --accent:#1E155C;
      --accent-2:#181451;
    }

    *{box-sizing:border-box}
    html,body{height:100%; overflow-x:hidden}
    body{
      margin:0; font-family:"Playfair Display", serif;
      color:var(--text); background:var(--bg); line-height:1.55;
    }
    img{max-width:100%; height:auto; display:block}
    a{color:inherit; text-decoration:none}
    .container{width:min(1200px, 92%); margin-inline:auto}

    /* Topbar */
    header{
      background:var(--bg);
      position:sticky; top:0; z-index:40;
      border-bottom:1px solid rgba(0,0,0,.05);
      backdrop-filter:saturate(160%) blur(6px);
    }
    .topbar{position:relative; display:flex; align-items:center; justify-content:center; gap:12px; padding:12px 0; min-height:60px}
    .back{position:absolute; left:0; top:50%; transform:translateY(-50%)}
    .back a{display:inline-flex; align-items:center; justify-content:center; padding:12px; border:none; background:transparent; border-radius:8px; line-height:0; cursor:pointer}
    .back a:hover{opacity:.85}
    .back a svg{width:28px; height:28px; fill:currentColor}
    .title{position:absolute; left:50%; transform:translateX(-50%); margin:0; font-weight:700; font-size:22px; letter-spacing:.3px; white-space:nowrap; text-align:center}
    .cart{position:absolute; right:0; top:50%; transform:translateY(-50%)}
    .cart a{display:inline-flex; align-items:center; justify-content:center; padding:12px; border-radius:10px; border:1px solid var(--line)}
    .cart svg{width:24px; height:24px}
    .badge{ margin-left:8px; min-width:18px; height:18px; padding:0 6px; border-radius:9px; background:#000; color:#fff; font-size:11px; line-height:18px; text-align:center; font-weight:900; display:none }

    /* Hero plein écran */
    .hero{
      position:relative;
      height: min(100svh, 92vh);
      display:grid; place-items:center;
      color:#fff; text-align:center;
      isolation:isolate;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background-image: var(--hero, url('https://picsum.photos/seed/hero-merch/2000/1200'));
      background-size:cover; background-position:center;
      transform:scale(1.03);
      filter:contrast(1.05) saturate(1.1);
      z-index:-2;
    }
    .hero::after{
      content:"";
      position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.35));
      z-index:-1;
    }
    .hero h1{ font-size: clamp(28px, 5vw, 56px); margin:0 12px; font-weight:900; letter-spacing:.5px }
    .hero p{ font-size: clamp(14px, 2.2vw, 18px); opacity:.92; max-width: 820px; margin:10px auto 0 }

    /* Sections */
    section{padding:40px 0}
    .h2{font-weight:700}
    .rule{width:225px; height:1px; background:#000; margin:8px 0 18px}
    .prose{font-weight:400; color:var(--muted)}

    /* Grille produits */
    .grid{
      display:grid;
      gap: clamp(14px, 2.8vw, 24px);
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      align-items: stretch;
    }
    .card{
      display:flex; flex-direction:column; height:100%;
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:12px; overflow:hidden;
    }

    /* Carrousel */
    .thumb{ position:relative; aspect-ratio:1/1; background:#f4f4f6 }
    .carousel{
      height:100%;
      display:flex; overflow-x:auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width:none;
    }
    .carousel::-webkit-scrollbar{ display:none }
    .slide{ flex:0 0 100%; height:100%; scroll-snap-align:center }
    .slide img{ width:100%; height:100%; object-fit:cover }

    .navbtn{
      position:absolute; top:50%; transform:translateY(-50%);
      width:34px; height:34px; border-radius:50%;
      display:grid; place-items:center; cursor:pointer;
      background:rgba(255,255,255,.9); border:1px solid var(--line);
      backdrop-filter:saturate(140%) blur(4px);
      user-select:none;
    }
    .navbtn:hover{ background:#fff }
    .nav-prev{ left:8px }
    .nav-next{ right:8px }

    .dots{
      position:absolute; left:50%; bottom:8px; transform:translateX(-50%);
      display:flex; gap:6px; padding:4px 8px; border-radius:999px;
      background:rgba(255,255,255,.8); border:1px solid var(--line)
    }
    .dot{
      width:7px; height:7px; border-radius:999px; background:#c8c8cc; transition:transform .15s, background .15s
    }
    .dot.active{ background:#111; transform:scale(1.15) }

    .card-body{padding:14px 16px; display:grid; gap:8px}
    .name{font-weight:700}
    .desc{
      color:var(--muted); font-size:.98rem;
      display:-webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow:hidden;
      min-height:3.6em;
    }
    .price{font-weight:800; margin-top:2px}

    .actions{display:flex; gap:10px; margin-top:8px}
    .ghost{
      display:inline-block; background:#fff; color:#111;
      border:1px solid var(--line); padding:10px 14px; border-radius:10px; font-size:14px; text-align:center; flex:1
    }

    @media (max-width: 768px){
      .title{font-size:18px}
    }
  </style>
</head>
<body>

  <!-- Top Bar -->
  <header>
    <div class="container topbar">
      <div class="back">
        <a href="https://loan881.github.io/loanturpin/" aria-label="Retour" title="Retour">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
        </a>
      </div>
      <h1 class="title">Merchandising</h1>
      <div class="cart">
        <a href="panier.html" aria-label="Panier">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 6h14l-1.6 9.5H9.2L7 6zm0 0L5.5 3H3"/><circle cx="10" cy="21" r="1.5"/><circle cx="18" cy="21" r="1.5"/></svg>
          <span id="cartBadge" class="badge">0</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Hero plein écran (change l'URL ci-dessous) -->
  <section class="hero" style="--hero:url('https://picsum.photos/seed/hero-merch-2/2000/1200')">
    <div class="container">
      <h1>Collection 2025</h1>
      <p>Affiches, textiles & goodies — imprimés à la demande. Faites défiler pour découvrir les pièces.</p>
    </div>
  </section>

  <!-- Intro -->
  <section>
    <div class="container">
      <h2 class="h2">Nos produits</h2>
      <div class="rule"></div>
      <p class="prose">Sélection de pièces et textiles, imprimés à la commande. Cliquez pour voir la fiche détaillée.</p>
    </div>
  </section>

  <!-- Grid -->
  <section>
    <div class="container">
      <div id="grid" class="grid" aria-live="polite"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer id="contact" class="site-footer" role="contentinfo">
    <hr class="divider" aria-hidden="true">
    <div class="footer-top" style="display:flex; gap:20px; justify-content:space-around; align-items:flex-start; padding: 10px 0 20px">
      <div class="col">
        <h5 class="footer-title">Page</h5>
        <hr class="divider w30" aria-hidden="true">
        <nav class="footer-links" aria-label="Footer navigation" style="display:grid; gap:12px; margin-top:14px">
          <a href="https://loan881.github.io/loanturpin/" class="nav-link">Home</a>
          <a href="https://loan881.github.io/loanturpin/gallery" class="nav-link">Gallery</a>
          <a href="https://loan881.github.io/loanturpin/theartstory" class="nav-link">The Art Story</a>
          <a href="https://loan881.github.io/loanturpin/contactme" class="nav-link">Contact Me.</a>
        </nav>
      </div>
      <div class="col">
        <h5 class="footer-title">Social Media</h5>
        <hr class="divider w82" aria-hidden="true">
        <div class="social-lines">
          <div class="line"><span>Instagram :</span> <a href="https://instagram.com/turpinloanart" target="_blank" rel="noopener noreferrer">turpinloanart</a></div>
          <div class="line"><span>TikTok :</span> <a href="https://tiktok.com/@turpinloanart" target="_blank" rel="noopener noreferrer">turpinloanart</a></div>
        </div>
      </div>
    </div>

    <div class="footer-contact" style="width:min(800px, 100%); margin: 0 auto; text-align:center; padding: 0 20px 20px">
      <h5 class="footer-title">Contact Me</h5>
      <hr class="divider" aria-hidden="true">
      <p class="line"><span>E-Mail :</span> <a href="mailto:t.loan.contact@gmail.com">t.loan.contact@gmail.com</a></p>
      <div class="credit" style="width:220px; margin: 20px auto 0">
        <hr class="divider thin" aria-hidden="true">
        <p>© 2025 TURPIN Loan</p>
      </div>
    </div>
  </footer>

  <script>
    /* ===== Utils ===== */
    const formatEUR = v => new Intl.NumberFormat('fr-FR', {style:'currency', currency:'EUR'}).format((v||0)/100);
    const el = id => document.getElementById(id);

    // Panier (badge uniquement)
    const CART_KEY = 'cart';
    const loadCart = ()=>{ try{ return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }catch{ return []; } };
    const cartCount = ()=> loadCart().reduce((n,l)=> n + Math.max(1, parseInt(l.qty||1,10)), 0);
    function updateCartBadge(){
      const n = cartCount();
      const b = el('cartBadge');
      if(n>0){ b.textContent = n; b.style.display='inline-block'; } else { b.style.display='none'; }
    }

    /* ===== Données (JSON + fallback) ===== */
    const FALLBACK = [
      { id:'tee-classic', name:'T-shirt Classic', description:'Coton 100% filé à l’anneau, coupe unisexe.', price:1990, currency:'EUR', images:[
          'https://picsum.photos/seed/tee1a/800/800','https://picsum.photos/seed/tee1b/800/800','https://picsum.photos/seed/tee1c/800/800'
      ] },
      { id:'hoodie-premium', name:'Hoodie Premium', description:'Molleton doux, capuche doublée.', price:3990, currency:'EUR', images:[
          'https://picsum.photos/seed/hood1a/800/800','https://picsum.photos/seed/hood1b/800/800'
      ] },
      { id:'mug-fun', name:'Mug Fun', description:'Céramique 325 ml, impression HQ.', price:1490, currency:'EUR', images:[
          'https://picsum.photos/seed/mug1a/800/800'
      ] }
    ];

    async function loadProducts(){
      try{
        const res = await fetch('data/products.json', { cache:'no-store' });
        if(!res.ok) throw new Error('json not found');
        const json = await res.json();
        const arr = Array.isArray(json) ? json : (json.products || json.items || []);
        if(!arr.length) throw new Error('empty');
        return arr.map(p => ({
          ...p,
          // normalisation images: accepte image OU images[] OU gallery[]
          images: Array.isArray(p.images) && p.images.length ? p.images
                : (Array.isArray(p.gallery) && p.gallery.length ? p.gallery
                : (p.image ? [p.image] : []))
        }));
      }catch(_){
        return FALLBACK;
      }
    }

    /* ===== Carrousel helpers ===== */
    function makeDots(n){
      const dots = document.createElement('div');
      dots.className = 'dots';
      for(let i=0;i<n;i++){
        const d = document.createElement('div');
        d.className = 'dot' + (i===0 ? ' active' : '');
        dots.appendChild(d);
      }
      return dots;
    }
    function setActiveDot(dots, i){
      const cs = dots.children;
      for(let k=0;k<cs.length;k++) cs[k].classList.toggle('active', k===i);
    }
    function nextIndex(car){
      return Math.min(Math.round(car.scrollLeft / car.clientWidth) + 1, car.children.length - 1);
    }
    function prevIndex(car){
      return Math.max(Math.round(car.scrollLeft / car.clientWidth) - 1, 0);
    }

    /* ===== Rendu cartes ===== */
    function makeCard(p){
      const imgs = (Array.isArray(p.images) && p.images.length ? p.images : [ `https://picsum.photos/seed/${encodeURIComponent(p.id)}/800/800` ]);
      const price = p.price;

      const wrap = document.createElement('div');
      wrap.className = 'card';

      // --- visuel (carrousel)
      const th = document.createElement('div');
      th.className = 'thumb';
      th.setAttribute('aria-label', `Images de ${p.name}`);

      const car = document.createElement('div');
      car.className = 'carousel';
      car.setAttribute('role','group');

      imgs.forEach((src, idx) => {
        const slide = document.createElement('div');
        slide.className = 'slide';
        slide.innerHTML = `<img src="${src}" alt="${p.name} — visuel ${idx+1}">`;
        car.appendChild(slide);
      });

      const btnPrev = document.createElement('button');
      btnPrev.className = 'navbtn nav-prev';
      btnPrev.type = 'button';
      btnPrev.setAttribute('aria-label','Image précédente');
      btnPrev.textContent = '◀';

      const btnNext = document.createElement('button');
      btnNext.className = 'navbtn nav-next';
      btnNext.type = 'button';
      btnNext.setAttribute('aria-label','Image suivante');
      btnNext.textContent = '▶';

      const dots = makeDots(imgs.length);

      th.appendChild(car);
      if (imgs.length > 1){
        th.appendChild(btnPrev); th.appendChild(btnNext); th.appendChild(dots);
      }
      wrap.appendChild(th);

      // --- contenu
      const body = document.createElement('div');
      body.className = 'card-body';
      body.innerHTML = `
        <div class="name">${p.name}</div>
        <div class="desc">${p.description || ''}</div>
        <div class="price">${formatEUR(price)}</div>
        <div class="actions">
          <a class="ghost" href="produit.html?id=${encodeURIComponent(p.id)}" aria-label="Voir ${p.name}">Voir</a>
        </div>
      `;
      wrap.appendChild(body);

      // --- interactions carrousel
      if (imgs.length > 1){
        btnNext.addEventListener('click', ()=> car.scrollTo({ left:(nextIndex(car))*car.clientWidth, behavior:'smooth' }));
        btnPrev.addEventListener('click', ()=> car.scrollTo({ left:(prevIndex(car))*car.clientWidth, behavior:'smooth' }));

        let ticking = false;
        car.addEventListener('scroll', ()=>{
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(()=>{
            const i = Math.round(car.scrollLeft / car.clientWidth);
            setActiveDot(dots, i);
            ticking = false;
          });
        });
      }

      return wrap;
    }

    async function render(){
      updateCartBadge();
      const products = await loadProducts();
      const grid = el('grid');
      grid.innerHTML = '';
      products.forEach(p => grid.appendChild(makeCard(p)));
    }

    render();
  </script>
</body>
</html>
