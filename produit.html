<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Détail produit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; }
    img { max-width: 320px; border-radius: 8px; }
    .price { font-weight: bold; font-size: 20px; margin: 10px 0; }
    button { padding: 10px 16px; border-radius: 10px; border: 1px solid #ddd; background:#111; color:#fff; cursor:pointer; }
    a { color: inherit; }
  </style>
</head>
<body>
  <a href="produits.html">← Retour au catalogue</a>
  <div id="product" style="margin-top:16px"></div>

  <script>
    async function init() {
      const params = new URLSearchParams(location.search);
      const id = params.get("id");

      // Charge le catalogue (chemin RELATIF pour GitHub Pages)
      const res = await fetch("data/products.json");
      const products = await res.json();

      const product = products.find(p => String(p.id) === String(id));
      const container = document.getElementById("product");

      if (!product) {
        container.innerHTML = `<p><strong>Produit introuvable</strong> (id=${id || "—"})</p>`;
        return;
      }

      container.innerHTML = `
        <h1>${product.name}</h1>
        <img src="${product.image}" alt="${product.name}">
        <p>${product.description || ""}</p>
        <div class="price">${(product.price/100).toFixed(2)} €</div>
        <button id="addCart">Ajouter au panier</button>
      `;

      document.getElementById("addCart").onclick = () => {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const existing = cart.find(item => item.id === product.id);
        if (existing) {
          existing.qty += 1;
        } else {
          cart.push({
            id: product.id,
            name: product.name,
            price: product.price,
            currency: product.currency,
            image: product.image,
            qty: 1
          });
        }
        localStorage.setItem("cart", JSON.stringify(cart));
        // Redirige vers le panier immédiatement
        window.location.href = "panier.html"; // ⚠️ pas de slash initial
      };
    }

    init();
  </script>
</body>
</html>

