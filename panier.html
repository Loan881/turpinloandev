<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Panier</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#fff; --text:#111; --muted:#2d2d2d; --accent:#1E155C; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Playfair Display", serif;
      color:var(--text);
      background:var(--bg);
      line-height:1.55;
      min-height:100dvh;         /* plein écran */
      display:flex;
      flex-direction:column;     /* header + main (flex:1) + footer */
    }
    a{color:inherit; text-decoration:none}
    .container{width:min(1200px, 92%); margin-inline:auto}

    /* Topbar */
    header{background:#fff; position:sticky; top:0; z-index:40; border-bottom:1px solid rgba(0,0,0,.05); backdrop-filter:saturate(160%) blur(6px)}
    .topbar{position:relative; display:flex; align-items:center; justify-content:center; gap:12px; padding:12px 0; min-height:60px}
    .back{position:absolute; left:0; top:50%; transform:translateY(-50%)}
    .back a{display:inline-flex; padding:12px; border-radius:8px}
    .title{position:absolute; left:50%; transform:translateX(-50%); margin:0; font-weight:700; font-size:22px}

    /* Layout principal */
    section{
      flex:1;                     /* occupe toute la hauteur restante */
      padding:32px 0;
      display:block;
    }
    .grid{ display:grid; grid-template-columns: 1fr minmax(260px, 360px); gap: clamp(16px, 3.5vw, 28px); align-items:start; }
    @media (max-width: 880px){ .grid{ grid-template-columns:1fr; } }
    .h2{font-weight:700}
    .rule{width:225px; height:1px; background:#000; margin:8px 0 18px}
    .muted{color:var(--muted)}

    /* Liste */
    .list{display:grid; gap:12px}
    .row{display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center; border:1px solid rgba(0,0,0,.08); border-radius:12px; padding:10px; background:#fff}
    .thumb{width:92px; height:92px; border-radius:10px; overflow:hidden; background:#f4f4f6; border:1px solid rgba(0,0,0,.06)}
    .thumb img{width:100%; height:100%; object-fit:cover}
    .meta{display:grid; gap:6px}
    .name{font-weight:700}
    .opt{font-size:.95rem; color:var(--muted)}
    .act{display:grid; gap:8px; justify-items:end}
    .qty{display:inline-grid; grid-auto-flow:column; gap:8px; align-items:center; border:1px solid rgba(0,0,0,.12); border-radius:999px; padding:4px 8px;}
    .qty button{ width:28px; height:28px; border-radius:50%; border:1px solid rgba(0,0,0,.12); background:#fff; cursor:pointer }
    .price{font-weight:800}
    .rm{background:transparent; border:none; color:#999; cursor:pointer; font-size:14px; text-decoration:underline}
    .empty{text-align:center; border:1px dashed rgba(0,0,0,.18); border-radius:12px; padding:28px}

    /* Résumé */
    .summary{ position:sticky; top:84px; background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:12px; padding:14px 16px; display:grid; gap:10px }
    .rowline{display:flex; justify-content:space-between; gap:12px}
    .total{font-weight:800; font-size: clamp(1.05rem, 1vw + 1rem, 1.25rem)}
    .buttons{display:grid; gap:10px; margin-top:6px}
    .button{display:inline-block; background:var(--accent); color:#fff; border:1px solid #000; padding:12px 16px; border-radius:10px; font-size:14px; text-align:center; cursor:pointer}
    .ghost{display:inline-block; background:#fff; color:#111; border:1px solid rgba(0,0,0,.12); padding:12px 16px; border-radius:10px; font-size:14px; text-align:center; cursor:pointer}

    /* Footer (collé en bas si contenu court) */
    footer.footer{ background:#fafafa; border-top:1px solid rgba(0,0,0,.08); }
    .footer .top{ padding:28px 0; display:grid; grid-template-columns: 1.2fr 1fr 1fr; gap: clamp(16px, 3vw, 28px); align-items:start; }
    @media (max-width: 880px){ .footer .top{ grid-template-columns:1fr; } }
    .footer h4{ margin:0 0 10px; font-weight:700; font-size:16px }
    .footer .logo{ font-weight:900; font-size:20px }
    .footer ul{ list-style:none; margin:0; padding:0; display:grid; gap:8px; }
    .footer a:hover{ text-decoration:underline; }
    .footbar{ border-top:1px solid rgba(0,0,0,.06); padding:12px 0 16px; display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .social{ display:flex; gap:10px; margin-top:10px }
    .social a{ display:inline-flex; width:32px; height:32px; border:1px solid rgba(0,0,0,.12); border-radius:8px; align-items:center; justify-content:center; background:#fff }
    .social svg{ width:16px; height:16px }
  </style>
</head>
<body>

  <!-- Top Bar -->
  <header>
    <div class="container topbar">
      <div class="back"><a href="index.html" aria-label="Retour" title="Retour">← Retour</a></div>
      <h1 class="title">Panier</h1>
    </div>
  </header>

  <!-- Contenu -->
  <section>
    <div class="container">
      <div class="grid">
        <div>
          <h2 class="h2">Vos articles</h2>
          <div class="rule"></div>

          <div id="empty" class="empty" style="display:none">
            Votre panier est vide.
            <a class="button" href="produits.html" style="margin-left:10px">Découvrir les produits</a>
          </div>

          <div id="list" class="list" aria-live="polite"></div>
        </div>

        <aside class="summary" aria-label="Récapitulatif">
          <div class="rowline"><span>Sous-total</span><strong id="subtotal">0 €</strong></div>
          <div class="rowline muted"><span>Frais de port</span><span>Calculés au paiement</span></div>
          <div class="rowline total"><span>Total</span><span id="total">0 €</span></div>
          <div class="buttons">
            <button id="clear" class="ghost" type="button">Vider le panier</button>
            <a class="button" href="checkout.html">Aller au paiement</a>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container top">
      <div>
        <a class="logo" href="index.html">Boutique</a>
        <p class="muted">Objets soignés, service rapide, retours faciles.</p>
        <div class="social" aria-label="Réseaux sociaux">
          <a href="#" aria-label="Instagram" title="Instagram">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><circle cx="17.5" cy="6.5" r="1"/></svg>
          </a>
          <a href="#" aria-label="X" title="X">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 4l16 16M20 4L4 20"/></svg>
          </a>
          <a href="#" aria-label="Facebook" title="Facebook">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 2h-3a4 4 0 0 0-4 4v3H8v4h3v9h4v-9h3l1-4h-4V6a1 1 0 0 1 1-1h3z"/></svg>
          </a>
        </div>
      </div>

      <nav aria-label="Navigation boutique">
        <h4>Boutique</h4>
        <ul>
          <li><a href="produits.html">Produits</a></li>
          <li><a href="panier.html" aria-current="page">Panier</a></li>
          <li><a href="checkout.html">Paiement</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>

      <nav aria-label="Informations légales">
        <h4>Infos</h4>
        <ul>
          <li><a href="#">Mentions légales</a></li>
          <li><a href="#">CGV</a></li>
          <li><a href="#">Confidentialité</a></li>
          <li><a href="#">Retours & remboursements</a></li>
        </ul>
      </nav>
    </div>

    <div class="container footbar">
      <div class="muted">© 2025 — Boutique</div>
      <div class="muted">Fait avec ♥</div>
    </div>
  </footer>

  <script>
    // ------- Utils monnaie / DOM
    const formatEUR = v =>
      new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'})
        .format((Number(v)||0)/100);
    const el = id => document.getElementById(id);

    // ------- Cart I/O (tolérant)
    const KEY = 'cart';

    function readRaw(){
      try { return JSON.parse(localStorage.getItem(KEY) || '[]'); }
      catch { return []; }
    }
    function writeRaw(arr){
      try { localStorage.setItem(KEY, JSON.stringify(arr)); }
      catch { /* localStorage indisponible/quota plein */ }
    }

    function normalizeLine(l){
      if (!l) return null;
      let id = l.id || l.productId || l.product_id || l.slug || l.sku || l.uid || l.ref || l.reference || null;
      const name = l.name || l.title || (id ? String(id) : null);
      if (!id && name) id = `${name}-${(l.option || l.variant || '')}`.trim();
      if (!id) return null;
      const qty = Math.max(1, parseInt(l.qty || 1, 10) || 1);
      let price = (l.price != null ? l.price : (l.unit_price != null ? l.unit_price : (l.amount != null ? l.amount : 0)));
      if (typeof price === 'string') price = price.replace(',', '.');
      price = Number(price);
      if (price < 10 && String(price).includes('.')) price = Math.round(price * 100); else price = Math.round(price);
      return {
        id,
        name: name || id,
        price: Number.isFinite(price) ? price : 0,
        currency: String(l.currency || 'EUR').toUpperCase(),
        image: l.image || 'https://picsum.photos/seed/placeholder/600/600',
        option: l.option || l.variant || '',
        qty
      };
    }

    function load(){
      const raw = readRaw();
      let arr = [];
      if (Array.isArray(raw)) arr = raw;
      else if (raw && typeof raw === 'object') arr = Object.values(raw);
      const norm = arr.map(normalizeLine).filter(Boolean);
      const map = new Map();
      for (const x of norm){
        const k = `${x.id}|${x.option||''}`;
        if (map.has(k)) map.get(k).qty += x.qty;
        else map.set(k, {...x});
      }
      return Array.from(map.values());
    }
    function save(lines){ writeRaw(lines); }

    function subtotal(lines){ return lines.reduce((s,l)=> s + l.price*l.qty, 0); }

    function render(){
      const list = el('list');
      const empty = el('empty');
      list.innerHTML = '';
      const lines = load();

      if (!lines.length){
        empty.style.display = 'block';
        el('subtotal').textContent = '0 €';
        el('total').textContent = '0 €';
        return;
      }
      empty.style.display = 'none';

      lines.forEach((l, i) => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div class="thumb"><img src="${l.image}" alt="${l.name}"></div>
          <div class="meta">
            <div class="name">${l.name}</div>
            ${l.option ? `<div class="opt">Variante : ${l.option}</div>` : ''}
            <button class="rm" data-i="${i}" aria-label="Retirer ${l.name}">Retirer</button>
          </div>
          <div class="act">
            <div class="qty" role="group" aria-label="Quantité ${l.name}">
              <button class="dec" data-i="${i}" aria-label="Diminuer">-</button>
              <span aria-live="polite">${l.qty}</span>
              <button class="inc" data-i="${i}" aria-label="Augmenter">+</button>
            </div>
            <div class="price">${formatEUR(l.price * l.qty)}</div>
          </div>
        `;
        list.appendChild(row);
      });

      const st = subtotal(lines);
      el('subtotal').textContent = formatEUR(st);
      el('total').textContent = formatEUR(st);

      // Délégation des actions
      list.onclick = (e) => {
        const inc = e.target.closest('.inc');
        const dec = e.target.closest('.dec');
        const rm  = e.target.closest('.rm');
        if (!inc && !dec && !rm) return;

        const c = load();
        if (inc){ c[+inc.dataset.i].qty += 1; save(c); render(); return; }
        if (dec){ c[+dec.dataset.i].qty = Math.max(1, c[+dec.dataset.i].qty - 1); save(c); render(); return; }
        if (rm){  c.splice(+rm.dataset.i, 1); save(c); render(); return; }
      };
    }

    el('clear').onclick = () => { writeRaw([]); render(); };
    render();
  </script>
</body>
</html>
